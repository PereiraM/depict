#!/usr/bin/env node

var child_process = require('child_process');
var optimist = require('optimist');

var argv = optimist
  .usage('Usage: depict URL OUT_FILE [-s SELECTOR]')
  .options('h', {
    alias: 'help',
    describe: 'Display help',
    default: false
  })
  .options('s', {
    alias: 'selector',
    describe: 'CSS selector',
    default: 'body'
  })
  .check(function(argv) {
    if (argv._.length !== 2) throw new Error('URL and OUT_FILE must be given.');
  })
  .argv;

if (argv.h || argv.help) return optimist.showHelp();

var url = argv._[0];
var selector = argv.s || argv.selector;
var out_file = argv._[1];

// TODO This is the default node install location
var prefix = '/usr/local/';

var args = [prefix + '/lib/node_modules/depict/src/depict-casperjs.js', url, selector, out_file];

casper = child_process.spawn('casperjs', args);

casper.stdout.on('data', function(data) {
    process.stdout.write(data);
});

